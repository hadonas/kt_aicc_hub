# AI Contact Center 기획서

## 프로덕트 이름
**AI Contact Center**

## 비전
**더 적은 인력으로 더 나은 응대를 – 산업 전반을 위한 AI 컨택센터 플랫폼**

## 미션
반복·표준 문의는 AI가 선제적으로 해결하고, 상담사는 고부가 업무에 집중하게 하여 고객사의 상담 인력 비용을 절감하면서 응답 품질과 고객 경험을 함께 향상한다.

## 핵심가치
- 반복·표준 문의를 자동화해 인력투입과 처리시간을 줄이고, 고객 만족도를 높인다.
- RAG로 출처를 제시하고 가드레일로 환각을 억제, 감사추적이 가능한 응답을 제공한다.
- MSA·오토스케일을 통해 트래픽 급증에도 안정적으로 운영하고, 음성(STT/TTS)·채팅 등 옴니채널을 유연하게 확장한다.
- 대화 로그 기반 품질평가(QA/TA)로 품질을 계속 고도화한다.

## 전략과제

### 🎯 우리의 목표 (단계별) ← 핵심 기능
1. **1단계**: NLP + RAG 구현 ✅ **완료**
2. **2단계**: PDF 파일 링크로 데이터 업로드 ✅ **완료**
3. **3단계**: TTS로 음성 응답 제공 ✅ **완료**
4. **4단계**: STT로 음성 질문 인식 ✅ **완료**

---

## 전략과제#1 : NLP + RAG 기반 자동 응답 시스템 구현 ✅ **완료**

### 1. 사용자 질문 수신
- 프론트엔드에서 고객이 자연어로 질문을 입력한다.
- qna-service가 질문을 받아 전체 응답 흐름을 제어한다.
- 질문 형태는 자유 텍스트 입력이며, 한 문장 내외로 처리한다.

### 2. 질문 임베딩 처리
- embedding-service에서 질문을 문장 벡터로 변환한다.
- 사전 학습된 모델(sentence-transformers, 예: all-MiniLM-L6-v2)을 활용한다.
- 입력: 사용자 질문 텍스트 → 출력: 고차원 임베딩 벡터 (예: 384차원)

### 3. 지식 검색 (RAG Retrieval)
- retriever-service가 질문 벡터와 knowledge-db-service에 저장된 지식 조각 벡터들과의 유사도를 계산한다.
- 벡터 유사도 기준은 cosine similarity 사용 (FAISS 활용).
- 관련도 높은 지식 문단 Top-K를 반환한다.

### 4. 답변 생성 (RAG Generation)
- generator-service가 질문 + 검색된 지식 문단들을 입력으로 받아 최종 응답 문장을 생성한다.
- 사용 기술: GPT-4.1 mini

### 5. 최종 응답 반환
- qna-service가 생성된 답변을 사용자에게 반환한다.
- 프론트엔드는 해당 응답을 텍스트 or TTS 음성으로 재생 가능

### 6. (선택) 질의/응답 기록 저장
- 질문, 생성된 응답, 검색된 지식 조각 등 세션 정보를 session-logger-service에 저장한다.
- 추후 감정 분석(TA), 품질 평가(QA), 피드백 개선 등에 활용 가능

---

## 전략과제#2 : PDF 파일 링크로 데이터 업로드 ✅ **완료**

### 1. PDF 문서 URL 입력
- 관리자가 프론트엔드에서 PDF 문서의 URL과 메타데이터를 입력한다.
- 입력 정보: PDF 링크, 상품군, 상품명, 판매기간, 문서타입 등

### 2. PDF 다운로드 및 텍스트 추출
- RAG Data Service가 PDF URL에서 문서를 다운로드한다.
- PDF 텍스트를 추출하고 적절한 크기의 청크로 분할한다.

### 3. 벡터 임베딩 생성
- 각 텍스트 청크를 Azure OpenAI의 text-embedding-ada-002 모델로 벡터화한다.
- 1536차원의 고차원 벡터로 변환하여 MongoDB Atlas에 저장한다.

### 4. 지식베이스 업데이트
- 새로운 문서 정보를 products 컬렉션에 저장한다.
- 청크별 벡터와 메타데이터를 documents 컬렉션에 저장한다.
- 이제 QnA Service에서 새로운 문서 정보를 검색할 수 있다.

---

## 전략과제#3 : TTS로 음성 응답 제공 ✅ **완료**

### 1. 텍스트 응답 수신
- 1단계에서 구현된 qna-service가 추천한 텍스트 형태의 답변을 수신한다.
- 해당 응답을 음성으로 변환하기 위해 tts-service로 전달한다.
- 텍스트는 짧은 문장 단위 (한 문단 이하)로 가정한다.

### 2. 텍스트 → 음성 변환 (TTS)
- tts-service는 입력받은 텍스트를 음성 파일(.wav 또는 .mp3)로 변환한다.
- Azure Neural Voice, gTTS, Coqui TTS, Naver CLOVA Dubbing 등 다양한 TTS 모델 활용
- 출력 포맷은 기본적으로 .mp3 파일 링크 or base64 인코딩된 오디오 데이터로 반환

### 3. 음성 파일 반환 및 재생
- 프론트엔드에서 해당 음성 파일을 재생한다.
- 음성 파일은 /audio 디렉토리에 정적 파일로 저장하거나, 응답 시 바로 base64로 전송해 `<audio>` 태그로 재생 가능

---



---

## 전략과제#4 : STT로 음성 질문 인식 ✅ **완료**

### 1. 음성 질문 수신
- 사용자가 프론트엔드에서 음성으로 질문을 입력한다.
- 음성 데이터는 .wav 또는 .mp3 형식으로 stt-service로 전달된다.

### 2. 음성 → 텍스트 변환 (STT)
- stt-service는 입력받은 음성 파일을 텍스트로 변환한다.
- Azure Cognitive Services, Google Speech-to-Text API, Whisper, Naver CLOVA Speech 등 활용
- 입력: .wav or .mp3 → 출력: 상담 질문 텍스트

### 3. 텍스트 질문을 QnA Service로 전달
- 변환된 텍스트를 qna-service로 전달하여 1단계 RAG 시스템과 연동
- 음성 상담의 완전한 사이클 완성 (STT → RAG → TTS)

---

## 시스템 아키텍처

### 전체 시스템 구조
본 시스템은 **KT의 AICC(AI Contact Center)를 본떠 만든 RAG(Retrieval-Augmented Generation) 기반 AI 상담 지원 서비스**로, 사용자의 질문(텍스트/음성)을 받아 관련 정보를 검색하고, AI가 생성한 답변을 음성으로 제공하여 고객 상담 경험을 향상시킵니다.

### 구성 서비스

#### 1. **QnA Service** - 핵심 RAG 엔진
- **목적**: 사용자 질문에 대한 AI 답변 생성 및 관련 문서 검색
- **기술**: FastAPI, Azure OpenAI, MongoDB Atlas, LangChain

#### 2. **RAG Data Service** - 데이터 관리
- **목적**: PDF 문서를 처리하여 RAG 시스템을 위한 벡터 데이터베이스 구축
- **기술**: Spring Boot 3.5.4, Java 21, MongoDB, Azure OpenAI
- **배포**: Azure App Service for Containers

#### 3. **Frontend** - 사용자 인터페이스
- **목적**: 웹 기반 상담 인터페이스
- **기술**: React, TypeScript, 모던 UI/UX

#### 4. **TTS Service** - 음성 합성
- **목적**: AI 답변을 자연스러운 음성으로 변환
- **기술**: FastAPI, Azure Neural Voice, 다국어 지원
- **배포**: Azure App Service for Containers

#### 5. **STT Service** - 음성 인식
- **목적**: 사용자 음성 질문을 텍스트로 변환
- **기술**: FastAPI, Azure Cognitive Services, 다국어 지원
- **배포**: Azure App Service for Containers

### 기술 스택

| 구분 | 기술 | 용도 |
|------|------|------|
| **API Gateway** | Azure API Management | API 라우팅, 인증, 모니터링 |
| **Backend Framework** | FastAPI, Spring Boot | 마이크로서비스 API 서버 |
| **AI/ML** | Azure OpenAI (GPT-4, text-embedding-ada-002) | 자연어 처리, 답변 생성, 벡터 임베딩 |
| **Vector Database** | MongoDB Atlas | 벡터 검색 및 문서 저장 |
| **Speech Services** | Azure Cognitive Services | STT/TTS 처리 |
| **Frontend** | Next.js (React + TypeScript) | 풀스택 웹 프레임워크 및 사용자 인터페이스 |
| **Container** | Docker | 서비스 컨테이너화 |
| **Language** | Python 3.11+, Java 21 | 백엔드 서비스 |
| **Runtime** | Uvicorn, JVM | ASGI 웹 서버, Java 런타임 |
| **Security** | Azure Key Vault | 민감한 정보(API 키, 비밀번호) 보안 관리 |
| **Monitoring** | Azure Monitor, Log Analytics | 중앙 집중식 모니터링 및 로그 분석 |

---

## 데이터베이스 스키마

### 데이터 구조
MongoDB는 두 개의 컬렉션으로 구성되어 있습니다.

#### **products 컬렉션 (상품 정보)**

| 필드명 | 설명 | 예시 |
|--------|------|------|
| _id | 고유 식별자 | ObjectId |
| product_group | 상품군 | "자동차보험-개인용" |
| product_name | 상품명 | "한화다이렉트자동차보험" |
| sale_period | 판매기간 | "2025.08.16~현재" |

#### **documents 컬렉션 (문서 청크)**

| 필드명 | 설명 | 예시 |
|--------|------|------|
| _id | 고유 식별자 | ObjectId |
| content | 텍스트 청크 내용 | "이 약관은 보험소비자의 권익보호..." |
| embedding | 벡터 임베딩 | [0.123, -0.456, ...] |
| source | PDF 파일명 | "한화다이렉트자동차보험_2025.08.16~현재_약관.pdf" |
| page_number | 페이지 번호 | 1, 2, 3... |
| chunk_index | 페이지 내 청크 순서 | 0, 1, 2... |
| chunk_length | 청크 길이 (문자 수) | 331, 581, 706... |
| product_id | 상품 참조 ID | ObjectId("products 컬렉션 참조") |
| type | 문서타입 | "상품요약", "약관", "사업방법" |
| download_link | 원본 문서 링크 | "https://www.hwgeneralins.com/..." |
| created_at | 생성 시간 | ISODate("2025-01-XX") |

---

## API 계약 명세

### 주요 API 엔드포인트

#### 🧠 QnA Service
- **GET /**: 서비스 상태 확인
- **GET /health**: 상세 헬스체크
- **POST /qna**: 질문-답변 처리 (RAG 기반 AI 답변 생성)

#### 📚 RAG Data Service
- **POST /api/v1/documents**: PDF 문서 업로드 및 벡터 처리
- **GET /api/v1/health**: 서비스 상태 확인
- **GET /actuator/health**: Spring Boot Actuator 헬스체크

#### 🎤 TTS Service
- **GET /, GET /health**: 서비스 상태 확인
- **POST /tts/convert**: 텍스트를 WAV 파일로 변환
- **POST /tts/convert-json**: JSON 응답 형태
- **POST /tts/convert-rag-response**: RAG 응답을 Multipart 형태로 변환
- **POST /tts/convert-rag-response-file**: RAG 응답을 WAV 파일로 직접 다운로드

#### 🎧 STT Service
- **POST /stt/convert**: 음성을 텍스트로 변환 (메인 엔드포인트)
- **GET /health**: 서비스 상태 확인
- **GET /docs, GET /redoc**: API 문서 (Swagger UI, ReDoc)

---

## 핵심 특징

- **🤖 RAG 기반 답변 생성**: 벡터 검색을 통한 정확한 보험 정보 제공으로 신뢰성 높은 답변 생성
- **🎤 음성 상담 지원**: STT(음성→텍스트) + TTS(텍스트→음성) 통합으로 접근성 향상 및 상담 효율성 증대
- **📚 동적 데이터 관리**: PDF 업로드 시 실시간 모델 반영으로 최신 보험 상품 정보 즉시 활용 가능
- **🔌 RESTful API 기반**: 표준화된 API로 다양한 클라이언트와의 쉬운 통합
- **⚡ 마이크로서비스 아키텍처**: 독립적인 서비스 배포와 확장으로 높은 가용성과 유지보수성 확보

---

## 시스템 모니터링 및 장애 대응

### 모니터링 구성요소
- **Azure Monitor**: 모든 Azure 서비스의 메트릭 및 로그 수집
- **Log Analytics**: 중앙 집중식 로그 분석 및 쿼리
- **Application Insights**: 애플리케이션 성능 모니터링 및 실시간 장애 감지
- **Azure App Service**: 기본적인 서비스 상태 및 리소스 모니터링
- **서비스별 헬스체크**: 각 마이크로서비스의 상태 확인 엔드포인트

### 주요 모니터링 지표

#### 1. **성능 지표**
- **응답 시간**: API 엔드포인트별 응답 시간 모니터링
- **처리량**: HTTP 요청 수 및 처리 성능
- **오류율**: HTTP 상태 코드별 오류 비율 (4xx, 5xx)
- **AI 모델 성능**: OpenAI API 응답 시간, 벡터 검색 성능

#### 2. **가용성 지표**
- **서비스 상태**: 각 마이크로서비스의 가동률 (Uptime)
- **서비스 다운타임**: 서비스 중단 시간 모니터링
- **헬스체크**: 정기적인 서비스 상태 점검

#### 3. **리소스 지표**
- **컴퓨팅**: CPU 사용률, 메모리 사용률
- **네트워크**: HTTP 요청 수, 응답 시간
- **데이터베이스**: MongoDB 연결 상태 및 성능

---

## 아키텍처 결정 기록 (ADR)

### 핵심 결정사항
- 🏗️ **아키텍처 설계**: RAG 시스템을 여러 단계로 분할하는 방향으로 초기 결정
- 🔄 **구현 방향 전환**: 시간적 제약과 응답 효율성을 고려하여 RAG 모델을 하나로 통합
- 🚦 **서비스 접근 방식**: 오케스트레이터 패턴을 활용하여 파편화된 서비스들에 대한 단일 진입점 제공
- 🗄️ **데이터베이스 구조**: 단일 컬렉션에서 products와 documents를 별도 컬렉션으로 분리하여 RAG 시스템 최적화

---

## 마이크로서비스 아키텍처 (MSA)

### 현재 MSA 아키텍처
- **동기식 HTTP API 기반**: 안정적인 서비스 구조
- **도메인 분리**: 상담, 문서 관리, 음성 처리 등 명확한 도메인 경계
- **확장 가능한 설계**: 향후 이벤트 기반 아키텍처로의 점진적 전환 계획

### 성능 및 확장성
- 현재 상태와 향후 목표 아키텍처 비교 분석
- 트래픽 급증 시 오토스케일링 지원
- 독립적인 서비스 배포와 확장으로 높은 가용성과 유지보수성 확보
