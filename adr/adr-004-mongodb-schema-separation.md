# ADR-004: MongoDB 스키마 분리 - 단일 컬렉션에서 이원화 구조로 전환

## Context

초기 설계에서는 모든 데이터를 하나의 컬렉션에 저장하는 단순한 구조였다. 하지만 RAG 시스템의 요구사항과 데이터 관리 효율성을 고려하면서, 스키마를 더 체계적으로 분리할 필요가 생겼다.

## Alternatives

| 방법 | 설명 | 장점 | 단점 |
|------|------|------|------|
| **단일 컬렉션 유지** | 모든 데이터를 하나의 컬렉션에 혼재 저장 | 구조 단순, 쿼리 단순화 | 데이터 타입별 관리 어려움, 확장성 제한, 쿼리 성능 저하 |
| **컬렉션 분리** | products와 documents를 별도 컬렉션으로 분리 | 데이터 타입별 최적화, 확장성 향상, 쿼리 성능 개선 | 구조 복잡성 증가, 관계 관리 필요 |

## Decision

**MongoDB 스키마를 두 개의 컬렉션으로 분리하기로 결정했다.**

**구체적 구조:**
- **`products` 컬렉션**: 상품 기본 정보 (상품군, 상품명, 판매기간)
- **`documents` 컬렉션**: 문서 청크 및 벡터 데이터 (내용, 임베딩, 메타데이터)

**선택 이유:**
- RAG 시스템의 효율적인 벡터 검색 지원
- 상품 정보와 문서 데이터의 명확한 분리
- 확장성과 성능 최적화

## Consequences

### 긍정적 영향
- ✅ 데이터 타입별 최적화된 저장 구조
- ✅ 벡터 검색 성능 향상
- ✅ 상품 정보와 문서 데이터의 명확한 분리
- ✅ 확장성 및 유지보수성 향상
- ✅ RAG 시스템 요구사항에 부합하는 구조

### 부정적 영향
- ⚠️ 스키마 복잡성 증가
- ⚠️ 컬렉션 간 관계 관리 필요
- ⚠️ 기존 데이터 마이그레이션 필요

### 후속 조치
- 기존 단일 컬렉션 데이터를 새로운 구조로 마이그레이션
- 컬렉션 간 관계를 위한 인덱스 설정
- 벡터 검색을 위한 임베딩 필드 최적화
- 스키마 버전 관리 및 문서화
